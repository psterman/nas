const express = require('express'); const fs = require('fs'); const path = require('path'); const router = express.Router(); const mappings = new Map(); // 添加映射 function addMapping(virtualPath, realPath) { mappings.set(virtualPath, realPath); } // 获取真实路径 function getRealPath(virtualPath) { for (const [vPath, rPath] of mappings) { if (virtualPath.startsWith(vPath)) { return path.join(rPath, virtualPath.slice(vPath.length)); } } return virtualPath; } // 获取文件列表 router.get('/files/*', (req, res) => { try { const virtualPath = req.params[0] || '/'; const realPath = getRealPath(virtualPath); const files = fs.readdirSync(realPath).map(file => { const stats = fs.statSync(path.join(realPath, file)); return { name: file, type: stats.isDirectory() ? 'folder' : 'file', size: stats.size, modified: stats.mtime, shared: false }; }); res.json(files); } catch (error) { res.status(500).json({ error: error.message }); } }); module.exports = router;
